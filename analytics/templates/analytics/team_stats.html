{% extends 'base.html' %}

{% block title %}Team Statistics{% endblock %}

{% block content %}
<div class="card">
    <h2>Team Statistics - {{ event.name }}</h2>
    <a href="{% url 'export_data' event.id %}?type=team_stats" class="btn">Export as CSV</a>
    <a href="{% url 'fetch_statbotics' event.id %}" class="btn btn-success">Update Statbotics Data</a>
</div>

<div class="card">
    {% if stats %}
    <table>
        <thead>
            <tr>
                <th>Team</th>
                <th>Nickname</th>
                <th>Overall Rating</th>
                <th>Avg Auto Pts</th>
                <th>Avg Teleop</th>
                <th>Climb %</th>
                <th>Total EPA</th>
                <th>Auto EPA</th>
                <th>Teleop EPA</th>
                <th>Win Rate</th>
                <th>Matches</th>
            </tr>
        </thead>
        <tbody>
            {% for stat in stats %}
            <tr>
                <td><strong>{{ stat.team.team_number }}</strong></td>
                <td>{{ stat.team.nickname|truncatechars:20|default:"-" }}</td>
                <td>{{ stat.avg_overall_rating|floatformat:1 }}</td>
                <td>{{ stat.avg_auto_points|floatformat:1 }}</td>
                <td>{{ stat.avg_teleop_game_pieces|floatformat:1 }}</td>
                <td>{{ stat.climb_success_rate|floatformat:0 }}%</td>
                <td style="background: {% if stat.statbotics_epa %}#e8f5e9{% endif %}">
                    {{ stat.statbotics_epa|floatformat:1|default:"-" }}
                </td>
                <td>{{ stat.statbotics_auto_epa|floatformat:1|default:"-" }}</td>
                <td>{{ stat.statbotics_teleop_epa|floatformat:1|default:"-" }}</td>
                <td>{{ stat.statbotics_win_rate|floatformat:2|default:"-" }}</td>
                <td>{{ stat.matches_scouted }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <p style="margin-top: 1rem; color: #666;">
        <strong>Note:</strong> Green-highlighted EPA values are from Statbotics. Internal ratings are based on scouting data.
    </p>
    {% else %}
    <p>No scouting data available yet. Scout some matches first!</p>
    {% endif %}
</div>
{% endblock %}
